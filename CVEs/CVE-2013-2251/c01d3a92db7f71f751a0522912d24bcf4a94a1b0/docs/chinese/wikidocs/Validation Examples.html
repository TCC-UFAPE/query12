<html>
    <head>
        <title>WebWork 2 : 校验示例</title>
	    <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=GBK">	    
    </head>

    <body>
	    <table class="pagecontent" border="0" cellpadding="0" cellspacing="0" width="100%" bgcolor="#ffffff">
		    <tr>
			    <td valign="top" class="pagebody">
				    <div class="pageheader">
					    <span class="pagetitle">
                            WebWork 2 : 校验示例
                                                    </span>
				    </div>
				    <div class="pagesubheading">
					    This page last changed on Nov 29, 2004 by <font color="#0050B2">jcarreira</font>.
				    </div>

				    <p class="paragraph">这是包含在<a href="WebWork.html" title="WebWork">WW:WebWork</a>示例war文件中一个使用<a href="http://wiki.opensymphony.com//display/XW/Validation+Framework" title="Validation Framework">XWork:校验框架</a>的例子. 例子由三部分组成, 使用相同的活动类和视图页面(Velocity).
<h2 class="heading2"><a name="ValidationExamples-Thesources"> 源代码</a></h2></p>首先, 将<b class="strong">validators.xml</b>文件加入到源代码根路径下
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;validators&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;required&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.RequiredFieldValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;requiredstring&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.RequiredStringValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;int&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.IntRangeFieldValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;date&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.DateRangeFieldValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;expression&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.ExpressionValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;fieldexpression&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.FieldExpressionValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;email&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.EmailValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;url&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.URLValidator&quot;</span>/&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator name=<span class="xml&#45;quote">&quot;visitor&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.xwork.validator.validators.VisitorFieldValidator&quot;</span>/&gt;</span>&#10;<span class="xml&#45;tag">&lt;/validators&gt;</span></pre>
</div></div><p class="paragraph">本例中使用的活动类是<b class="strong">ValidatedAction</b>
<div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">package</span> com.opensymphony.webwork.example;&#10;&#10;<span class="java&#45;keyword">import</span> com.opensymphony.xwork.ActionSupport;&#10;&#10;/&#42;&#42;&#10; &#42; ValidatedAction&#10; &#42; &#64;author Jason Carreira&#10; &#42; Created Sep 12, 2003 9:23:38 PM&#10; &#42;/&#10;<span class="java&#45;keyword">public</span> class ValidatedAction <span class="java&#45;keyword">extends</span> ActionSupport &#123;&#10;    <span class="java&#45;keyword">private</span> ValidatedBean bean = <span class="java&#45;keyword">new</span> ValidatedBean();&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> name;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> validationAction = <span class="java&#45;quote">&quot;basicValidation.action&quot;</span>;&#10;&#10;    <span class="java&#45;keyword">public</span> ValidatedBean getBean() &#123;&#10;        <span class="java&#45;keyword">return</span> bean;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> void setBean(ValidatedBean bean) &#123;&#10;        <span class="java&#45;keyword">this</span>.bean = bean;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getName() &#123;&#10;        <span class="java&#45;keyword">return</span> name;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> void setName(<span class="java&#45;object">String</span> name) &#123;&#10;        <span class="java&#45;keyword">this</span>.name = name;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getValidationAction() &#123;&#10;        <span class="java&#45;keyword">return</span> validationAction;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> void setValidationAction(<span class="java&#45;object">String</span> validationAction) &#123;&#10;        <span class="java&#45;keyword">this</span>.validationAction = validationAction;&#10;    &#125;&#10;&#125;</pre>
</div></div></p>ValidatedAction的基本校验文件是<b class="strong">ValidatedAction-validation.xml</b>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE validators PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot;</span>&#160;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;</span>&gt;</span>&#10;<span class="xml&#45;tag">&lt;validators&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;name&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;requiredstring&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message&gt;</span>You must enter a name.<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;<span class="xml&#45;tag">&lt;/validators&gt;</span></pre>
</div></div><br/>
它与其它校验文件放置在与类相同的目录下.<p class="paragraph">活动的表单是<b class="strong">validationForm.vm</b>
<div class="code"><div class="codeContent">
<pre>&lt;html&gt;&#10;&lt;head&gt;&lt;title&gt;Webwork Validation Example&lt;/title&gt;&lt;/head&gt;&#10;&lt;body&gt;&#10;#<span class="java&#45;keyword">if</span>( $actionErrors.size() &gt; 0 )&#10;&lt;p&gt;&#10;&lt;font color=<span class="java&#45;quote">&quot;red&quot;</span>&gt;&#10;&lt;b&gt;ERRORS:&lt;/b&gt;&lt;br&gt;&#10;&lt;ul&gt;&#10;#foreach( $error in $actionErrors )&#10;&lt;li&gt;$error&lt;/li&gt;&#10;#end&#10;&lt;/ul&gt;&#10;&lt;/font&gt;&#10;&lt;/p&gt;&#10;#end&#10;&lt;p&gt;&#10;&lt;form name=<span class="java&#45;quote">&quot;myForm&quot;</span> action=<span class="java&#45;quote">&quot;$&#123;validationAction&#125;&quot;</span> method=<span class="java&#45;quote">&quot;POST&quot;</span>&gt;&#10;&lt;input type=<span class="java&#45;quote">&quot;hidden&quot;</span> name=<span class="java&#45;quote">&quot;validationAction&quot;</span> value=<span class="java&#45;quote">&quot;$&#123;validationAction&#125;&quot;</span>/&gt;&#10;Action Properties:&#10;&lt;br&gt;&#10;&lt;table&gt;&#10;#tag( TextField <span class="java&#45;quote">&quot;label=Name&quot;</span>&#160;<span class="java&#45;quote">&quot;name=name&quot;</span>&#160;<span class="java&#45;quote">&quot;value=name&quot;</span> )&#10;&lt;/table&gt;&#10;Bean Properties:&#10;#<span class="java&#45;keyword">if</span>( $stack.findValue(<span class="java&#45;quote">&quot;fieldErrors&quot;</span>) )&#10;    #set( $beanErrors = $stack.findValue(<span class="java&#45;quote">&quot;fieldErrors.get(&#039;bean&#039;)&quot;</span>) )&#10;    #<span class="java&#45;keyword">if</span>( $beanErrors.size() &gt; 0 )&#10;    &lt;br&gt;&#10;    &lt;font color=<span class="java&#45;quote">&quot;red&quot;</span>&gt;&#10;    &lt;b&gt;Bean Errors:&lt;/b&gt;&lt;br&gt;&#10;    &lt;ul&gt;&#10;    #foreach( $beanError in $beanErrors )&#10;    &lt;li&gt;$beanError&lt;/li&gt;&#10;    #end&#10;    &lt;/ul&gt;&#10;    &lt;/font&gt;&#10;    #end&#10;#end&#10;&lt;table&gt;&#10;#tag( TextField <span class="java&#45;quote">&quot;label=Bean.Text&quot;</span>&#160;<span class="java&#45;quote">&quot;name=bean.text&quot;</span>&#160;<span class="java&#45;quote">&quot;value=bean.text&quot;</span> )&lt;br&gt;&#10;#tag( TextField <span class="java&#45;quote">&quot;label=Bean.Date&quot;</span>&#160;<span class="java&#45;quote">&quot;name=bean.date&quot;</span>&#160;<span class="java&#45;quote">&quot;value=bean.date&quot;</span> )&lt;br&gt;&#10;#tag( TextField <span class="java&#45;quote">&quot;label=Bean.<span class="java&#45;object">Number</span>&quot;</span>&#160;<span class="java&#45;quote">&quot;name=bean.number&quot;</span>&#160;<span class="java&#45;quote">&quot;value=bean.number&quot;</span> )&lt;br&gt;&#10;#tag( TextField <span class="java&#45;quote">&quot;label=Bean.Number2&quot;</span>&#160;<span class="java&#45;quote">&quot;name=bean.number2&quot;</span>&#160;<span class="java&#45;quote">&quot;value=bean.number2&quot;</span> )&lt;br&gt;&#10;&lt;/table&gt;&#10;&lt;input type=<span class="java&#45;quote">&quot;submit&quot;</span> value=<span class="java&#45;quote">&quot;Test Validation&quot;</span>/&gt;&#10;&lt;/form&gt;&#10;&lt;/body&gt;</pre>
</div></div></p>本例的成功页面非常简单, <b class="strong">valid.vm</b>
<div class="code"><div class="codeContent">
<pre>&lt;html&gt;&#10;&lt;head&gt;&lt;title&gt;WebWork Validation Test: Valid&lt;/title&gt;&lt;/head&gt;&#10;&lt;body&gt;&#10;Input was valid&#33;&#10;&lt;/body&gt;&#10;&lt;/html&gt;</pre>
</div></div><p class="paragraph">后面我们将展示本例中其他配置文件的内容.
<h2 class="heading2"><a name="ValidationExamples-%3Caname%3D%22ValidationExamplesBasicValidation%22%3E%3C%2Fa%3EBasicValidation"> <a name="ValidationExamples-BasicValidation"></a> 基本校验</a></h2></p>基本校验例子定义在<b class="strong">xwork.xml</b>中
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;basicValidation&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.ValidatedAction&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;validationWorkflowStack&quot;</span>/&gt;</span>&#10;&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>valid.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;input&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>validationForm.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;error&quot;</span> type=<span class="xml&#45;quote">&quot;dispatcher&quot;</span>&gt;</span>validationForm.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/action&gt;</span></pre>
</div></div><p class="paragraph">这里<b class="strong">interceptor-ref</b>的值<b class="strong">&quot;validationWorkflowStack&quot;</b>定义在webwork-default.xml中, 它提供ValidationInterceptor(参见<a href="http://wiki.opensymphony.com//display/XW/Validation+Framework" title="Validation Framework">XWork:校验框架</a>和DefaultWorkFlowInterceptor(参见<a href="http://wiki.opensymphony.com//display/XW/Interceptors#Interceptors-DefaultWorkflow" title="DefaultWorkflow on Interceptors">XWork:DefaultWorkflow</a>)的截取功能. 配置文件中所有的参数(本例中有一个)都从request取出设置到活动. 接下来, 执行校验, 最后将执行DefaultWorkflow(参见<a href="http://wiki.opensymphony.com//display/XW/Interceptors#Interceptors-DefaultWorkflow" title="DefaultWorkflow on Interceptors">XWork:DefaultWorkflow</a>).</p>本例十分简单, 仅使用了一个配置文件ValidatedAction-validation.xml. 这意味着只校验name字段是否输入内容. 
<h2 class="heading2"><a name="ValidationExamples-%3Caname%3D%22ValidationExamplesVisitorValidation%22%3E%3C%2Fa%3EVisitorValidationExample"> <a name="ValidationExamples-VisitorValidation"></a> 访问者校验示例</a></h2><p class="paragraph"><em class="emphasis">注意: 查看另一个<a href="VisitorFieldValidatorExample.html" title="VisitorFieldValidatorExample">访问者字段校验器示例</a></em>.</p> <b class="strong">ValidatedAction</b>包含一个普通Java对象引用, <b class="strong">ValidatedBean</b>:
<div class="code"><div class="codeContent">
<pre><span class="java&#45;keyword">package</span> com.opensymphony.webwork.example;&#10;&#10;<span class="java&#45;keyword">import</span> java.util.Date;&#10;&#10;/&#42;&#42;&#10; &#42; ValidatedBean&#10; &#42; &#64;author Jason Carreira&#10; &#42; Created Sep 12, 2003 9:24:18 PM&#10; &#42;/&#10;<span class="java&#45;keyword">public</span> class ValidatedBean &#123;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">String</span> text;&#10;    <span class="java&#45;keyword">private</span> Date date = <span class="java&#45;keyword">new</span> Date(<span class="java&#45;object">System</span>.currentTimeMillis());&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span> number;&#10;    <span class="java&#45;keyword">private</span>&#160;<span class="java&#45;object">int</span> number2;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;keyword">static</span>&#160;<span class="java&#45;keyword">final</span>&#160;<span class="java&#45;object">int</span> MAX&#95;TOTAL = 12;&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">String</span> getText() &#123;&#10;        <span class="java&#45;keyword">return</span> text;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> void setText(<span class="java&#45;object">String</span> text) &#123;&#10;        <span class="java&#45;keyword">this</span>.text = text;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> Date getDate() &#123;&#10;        <span class="java&#45;keyword">return</span> date;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> void setDate(Date date) &#123;&#10;        <span class="java&#45;keyword">this</span>.date = date;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">int</span> getNumber() &#123;&#10;        <span class="java&#45;keyword">return</span> number;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> void setNumber(<span class="java&#45;object">int</span> number) &#123;&#10;        <span class="java&#45;keyword">this</span>.number = number;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span>&#160;<span class="java&#45;object">int</span> getNumber2() &#123;&#10;        <span class="java&#45;keyword">return</span> number2;&#10;    &#125;&#10;&#10;    <span class="java&#45;keyword">public</span> void setNumber2(<span class="java&#45;object">int</span> number2) &#123;&#10;        <span class="java&#45;keyword">this</span>.number2 = number2;&#10;    &#125;&#10;&#125;</pre>
</div></div><p class="paragraph">ValidatedBean的校验配置文件是<b class="strong">ValidatedBean-validation.xml</b>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE validators PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot;</span>&#160;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;</span>&gt;</span>&#10;<span class="xml&#45;tag">&lt;validators&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;text&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;requiredstring&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message key=<span class="xml&#45;quote">&quot;invalid.text&quot;</span>&gt;</span>Empty Text&#33;<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;date&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;date&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;min&quot;</span>&gt;</span>01/01/1970<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message key=<span class="xml&#45;quote">&quot;invalid.date&quot;</span>&gt;</span>Invalid Date&#33;<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;number&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;int&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;min&quot;</span>&gt;</span>1<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;max&quot;</span>&gt;</span>10<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message key=<span class="xml&#45;quote">&quot;invalid.number&quot;</span>&gt;</span>Invalid Number&#33;<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;<span class="xml&#45;tag">&lt;/validators&gt;</span></pre>
</div></div></p>本例中, 增加一个<b class="strong">VisitorFieldValidator</b>来实现对<b class="strong">ValidatedBean</b>的校验. 活动定义在<b class="strong">xwork.xml</b>文件中:
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;visitorValidation&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.ValidatedAction&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;validationWorkflowStack&quot;</span>/&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;validationAction&quot;</span>&gt;</span>visitorValidation.action<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span>&gt;</span>valid.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;input&quot;</span>&gt;</span>validationForm.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;error&quot;</span>&gt;</span>validationForm.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/action&gt;</span></pre>
</div></div><p class="paragraph">可以发现本利于基本校验的细微差别. 活动增加了一个静态参数. 该参数设置了对表单进行校验的活动(参见<b class="strong">validationForm.vm</b>).</p>活动的名字, <em class="emphasis">visitorValidation</em>映射到另一个文件<b class="strong">ValidatedAction-visitorValidation-validation.xml</b>中的校验活动
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE validators PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot;</span>&#160;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;</span>&gt;</span>&#10;<span class="xml&#45;tag">&lt;validators&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;bean&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;required&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message&gt;</span>The bean must not be null.<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;visitor&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message&gt;</span>bean: <span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;<span class="xml&#45;tag">&lt;/validators&gt;</span></pre>
</div></div><p class="paragraph">校验框架将基于类名(ValidatedAction), 活动别名(visitorValidation)和标准后缀(-validation.xml)组成文件名<b class="strong">ValidatedAction-visitorValidation-validation.xml</b>.</p>该文件为bean字段定义了两个校验器： required校验器保证bean不为null; VisitorFieldValidator. VisitorFieldValidator将使用<b class="strong">ValidatedBean</b>的校验配置并使用与<b class="strong">ValidatedAction</b>相同的校验上下文(validation context)<em class="emphasis">visitorValidation</em>. 因此将顺序查找文件<b class="strong">ValidatedBean-validation.xml</b> (ValidatedBean的缺省校验文件)和<b class="strong">ValidatedBean-visitorValidation-validation.xml</b> (本校验上下文使用的校验).<p class="paragraph"><b class="strong">ValidatedBean-validation.xml</b>如下:</p><div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE validators PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot;</span>&#160;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;</span>&gt;</span>&#10;<span class="xml&#45;tag">&lt;validators&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;text&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;requiredstring&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message key=<span class="xml&#45;quote">&quot;invalid.text&quot;</span>&gt;</span>Empty Text&#33;<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;date&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;date&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;min&quot;</span>&gt;</span>01/01/1970<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message key=<span class="xml&#45;quote">&quot;invalid.date&quot;</span>&gt;</span>Invalid Date&#33;<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;number&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;int&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;min&quot;</span>&gt;</span>1<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;max&quot;</span>&gt;</span>10<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message key=<span class="xml&#45;quote">&quot;invalid.number&quot;</span>&gt;</span>Invalid Number&#33;<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;<span class="xml&#45;tag">&lt;/validators&gt;</span></pre>
</div></div><p class="paragraph">该文件校验三个字段(text, date, and number)并未它们提供了消息. 消息键值将用于在<b class="strong">ValidatedBean</b>类指定的资源文件中查找文本. 与<b class="strong">ValidatedBean</b>在同一目录中文件名为<b class="strong">ValidatedBean.properties</b>
<div class="code"><div class="codeContent">
<pre>invalid.date=You must enter a date after $&#123;min&#125;.&#10;invalid.text=You must enter some text.&#10;invalid.number=You must enter a number between $&#123;min&#125; and $&#123;max&#125;.&#10;invalid.total=The total of number and number2 must be less than $&#123;&#64;com.opensymphony.webwork.example.ValidatedBean&#64;MAX&#95;TOTAL&#125;.</pre>
</div></div></p>这些消息将用于任何与<b class="strong">ValidatedBean</b>有关的错误中. 如你所见, 消息体可以使用Bean, 截取器, 活动的属性(将按照这样的顺序进行搜索)进行参数化. 这也是一个使用静态字段的例子 <b class="strong">$&#123;@com.opensymphony.webwork.example.ValidatedBean@MAX_TOTAL}</b>.<p class="paragraph"><b class="strong">ValidatedBean-visitorValidation-validation.xml</b>文件定义<em class="emphasis">visitorValidation</em> 校验上下文下的校验规则, 但它并不存在, 因此被忽略.
<h2 class="heading2"><a name="ValidationExamples-%3Caname%3D%22ValidationExamplesExpression%22%3E%3C%2Fa%3EVisitorValidationwiththeExpressionValidator"> <a name="ValidationExamples-Expression"></a> 带有表达式校验器的访问者校验</a></h2></p>最后一个例子的配置与上一个例子类似. 本例的<b class="strong">xwork.xml</b>配置和<b class="strong">visitorValidation</b>例子中的很相似
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;action name=<span class="xml&#45;quote">&quot;expressionValidation&quot;</span> class=<span class="xml&#45;quote">&quot;com.opensymphony.webwork.example.ValidatedAction&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;interceptor&#45;ref name=<span class="xml&#45;quote">&quot;validationWorkflowStack&quot;</span>/&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;validationAction&quot;</span>&gt;</span>expressionValidation.action<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;success&quot;</span>&gt;</span>valid.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;input&quot;</span>&gt;</span>validationForm.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;            <span class="xml&#45;tag">&lt;result name=<span class="xml&#45;quote">&quot;error&quot;</span>&gt;</span>validationForm.vm<span class="xml&#45;tag">&lt;/result&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/action&gt;</span></pre>
</div></div><p class="paragraph">文件<b class="strong">ValidatedAction-expressionValidation-validation.xml</b>定义该校验上下文的检验规则:
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE validators PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot;</span>&#160;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;</span>&gt;</span>&#10;<span class="xml&#45;tag">&lt;validators&gt;</span>&#10;    <span class="xml&#45;tag">&lt;field name=<span class="xml&#45;quote">&quot;bean&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;required&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message&gt;</span>The bean must not be null.<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;        <span class="xml&#45;tag">&lt;field&#45;validator type=<span class="xml&#45;quote">&quot;visitor&quot;</span>&gt;</span>&#10;            <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;context&quot;</span>&gt;</span>expression<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;            <span class="xml&#45;tag">&lt;message&gt;</span>bean: <span class="xml&#45;tag">&lt;/message&gt;</span>&#10;        <span class="xml&#45;tag">&lt;/field&#45;validator&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/field&gt;</span>&#10;<span class="xml&#45;tag">&lt;/validators&gt;</span></pre>
</div></div></p>它几乎与<b class="strong">ValidatedAction-visitorValidation-validation.xml</b>文件一样, 但它为<b class="strong">VisitorFieldValidator</b>传递了一个context参数. 本例中, 不使用与<b class="strong">ValidatedAction</b>相同的校验上下文(<em class="emphasis">expressionValidation</em>), 它传递了另一个上下文(<em class="emphasis">expression</em>). <p class="paragraph">本例中, 针对<b class="strong">ValidatedBean</b>的校验文件已经存在, 名字是<b class="strong">ValidatedBean-expression-validation.xml</b>
<div class="code"><div class="codeContent">
<pre><span class="xml&#45;tag">&lt;&#33;DOCTYPE validators PUBLIC <span class="xml&#45;quote">&quot;&#45;//OpenSymphony Group//XWork Validator 1.0//EN&quot;</span>&#160;<span class="xml&#45;quote">&quot;&#104;ttp://www.opensymphony.com/xwork/xwork&#45;validator&#45;1.0.dtd&quot;</span>&gt;</span>&#10;<span class="xml&#45;tag">&lt;validators&gt;</span>&#10;    <span class="xml&#45;tag">&lt;validator type=<span class="xml&#45;quote">&quot;expression&quot;</span>&gt;</span>&#10;        <span class="xml&#45;tag">&lt;param name=<span class="xml&#45;quote">&quot;expression&quot;</span>&gt;</span>&#64;com.opensymphony.webwork.example.ValidatedBean&#64;MAX&#95;TOTAL &gt; (number &#43; number2)<span class="xml&#45;tag">&lt;/param&gt;</span>&#10;        <span class="xml&#45;tag">&lt;message key=<span class="xml&#45;quote">&quot;invalid.total&quot;</span>&gt;</span>Invalid total&#33;<span class="xml&#45;tag">&lt;/message&gt;</span>&#10;    <span class="xml&#45;tag">&lt;/validator&gt;</span>&#10;<span class="xml&#45;tag">&lt;/validators&gt;</span></pre>
</div></div><br/>
这增加了一个对象级别的(与之相反的是字段级别)ExpressionValidator, 将number和number2字段的和与静态常量比较, 如果总和大于常量将增加一个错误信息. 
<h2 class="heading2"><a name="ValidationExamples-%3Caname%3D%22ValidationExamplesErrorMessages%22%3E%3C%2Fa%3EAnoteabouterrormessageswiththeVisitorFieldValidator"> <a name="ValidationExamples-ErrorMessages"></a> VisitorFieldValidator错误信息注意事项</a></h2></p>使用VisitorFieldValidator, 消息字段名使用对象的字段名. 本例中, <b class="strong">ValidatedBean</b>的字段&quot;<em class="emphasis">text</em>&quot;, &quot;<em class="emphasis">date</em>&quot;, &quot;<em class="emphasis">number</em>&quot;的错误信息将使用字段名&quot;<em class="emphasis">bean.text</em>&quot;, &quot;<em class="emphasis">bean.date</em>&quot;, &quot;<em class="emphasis">bean.number</em>&quot;. 最后一个例子中的对象级别的ExpressionValidator产生的错误信息将作为一个字段级别的错误使用名字&quot;<em class="emphasis">bean</em>&quot;添加到活动中.

				    
                    			    </td>
		    </tr>
	    </table>
	    <table border="0" cellpadding="0" cellspacing="0" width="100%">
			<tr>
				<td height="12" background="border/border_bottom.gif"><img src="border/spacer.gif" width="1" height="1" border="0"/></td>
			</tr>
		    <tr>
			    <td align="center"><font color="grey">Document generated by Confluence on Dec 14, 2004 16:36</font></td>
		    </tr>
	    </table>
    </body>
</html>